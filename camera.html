<!DOCTYPE html>
<html>
	<head>
		<title>This is a test</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="camera.css">
		<!--<script src="camera.js"></script> -->
		<script>

			document.addEventListener('DOMContentLoaded', function() {
				let pages = [... document.querySelectorAll('.page')];
				let nextButtons = [... document.querySelectorAll('.next-button')];
				let backButtons = [... document.querySelectorAll('.back-button')];
				let allButtons = nextButtons.concat(backButtons);

				const hidePages = () => {
					pages.forEach((page) => page.style.display = "none")
				};

				const move = (target) => {
					hidePages();
					let position = parseInt(target.id.match(/\d+/g));
					let isForward = /forward/.test(target.id);
					if (isForward) {
						pages[position].style.display = "block"; }
					else {
						pages[position - 2].style.display = "block";}
				};

				let allSymptoms = document.querySelectorAll('.symptom');
				allSymptoms.forEach((symptom) => {
					symptom.addEventListener('click', (event)=> {
						event.target.classList.add('has-symptom')
					})
				})

				hidePages();
				pages[0].style.display = 'block';
				allButtons.forEach((button)=> button.addEventListener('click', ()=> move(event.target)));
				
				let genderOptions = [... document.querySelectorAll('.genders')];
				genderOptions.forEach((option) => {
					option.addEventListener('click', (event)=> {
						genderOptions.forEach((o) => o.classList.remove('gender-selected'))
						event.target.classList.add('gender-selected')
					})
				})

				let lengthOptions = [... document.querySelectorAll('.time-frame')]
				lengthOptions.forEach((option) => {
					option.addEventListener('click', (event) => {
						lengthOptions.forEach((o) => o.classList.remove('length-selected'))
						event.target.classList.add('length-selected')
					})
				})

				let sendAll = document.querySelector('#send'); 


				sendAll.addEventListener('click', () => {
					// pull all relavant data as is at time of send click
					let age = document.querySelector('#age').value;
					let gender = document.querySelector('.gender-selected').innerHTML;
					let zipCode = document.querySelector('#zip').value;
					let symptomLength = document.querySelector('.length-selected').innerHTML;
					// user Symptoms as Array? 
					let userSymptoms = [...document.querySelectorAll('.has-symptom')];
					let userSymptomsArray = userSymptoms.map((symptom) => {
						return symptom.innerHTML;
					})

					// package data as object literal
					let jsonData = {
						age: age,
						gender: gender,
						symptoms: userSymptomsArray,
						symptomLength: symptomLength,
						// not a secure solution
						token: "xoxb-284170590867-1faIFkh6NLsAN7GFsmSAVfdG",
						zipCode: zipCode
					};

					// create Data AJAX call
					let xhr = new XMLHttpRequest();
					// Is this URL correct
					let url = "http://rest.privateye.ai/";
					xhr.open("POST", url, true);
					xhr.setRequestHeader("Content-type", "application/json");
					xhr.onreadystatechange = function () {
						if (xhr.readyState === 4 && xhr.status === 200) {
							var json = JSON.parse(xhr.responseText);
							console.log(json);
							}
					};
					// create JSON and send AJAX
					let data = JSON.stringify(jsonData);
					xhr.send(data);

					// grab the file as FormData
					let fileForm = document.querySelector('#camera');
					let file = fileForm.files[0];
					let fileUpload = new FormData();
					fileUpload.append('file', file);

					// File AJAX call
					let xhrFile = new XMLHttpRequest();
					// Is the URL the same for File upload?
					xhr.open('POST', 'techchicago.net', true);
					xhr.send(fileUpload);
				})

			});
		</script>
	<head>
	<body>
		<div class="page" id="page-1">
				<h1>LuminDx</h1>
				<h3>Debugging Dermatology</h3>
				<button class="next-button" id="page-1-forward">Touch to continue</button>
		</div>
		<div class="page" id="page-2">
			<p>LxuxmxixnxDx analyzes photos taken on your phone and shows you images of conditions similar to what you are experiencing.</p>
			<p>Your data is:</p>
			<ul>
				<li>Secure</li>
				<li>Private</li>
			<ul>
			<button class="back-button" id="page-2-back">Touch to go back</button>
			<button class='next-button' id="page-2-forward">Touch to continue</button>
		</div>
		<div class="page" id="page-3">
			<table>
				<tr>
					<td>Go to a well lit area</td>
					<td></td>
				</tr>
				<tr>
					<td>Turn on all available lights</td>
					<td></td>
				</tr>
				<tr>
					<td>Avoid shadows</td>
					<td></td>
				</tr>
				<tr>
					<td>Remove phone case if it obstructs image</td>
					<td></td>
				</tr>
				<tr>
					<td>Wipe camera with a soft, clean cloth</td>
					<td></td>
				</tr>
				<tr>
					<td>Tape center of the screen to keep groin area in focus</td>
					<td></td>
				</tr>
				<tr>
					<td>Hold your phone one foot away from your groin area</td>
					<td></td>
				</tr>
				<tr>
					<td>As far as possible, use the rear camera</td>
					<td></td>
				</tr>
			</table>
			<button class="back-button" id="page-3-back">Touch to go back</button>
			<button class='next-button' id="page-3-forward">Touch to continue</button>
		</div>
		<div class="page" id="page-4">
			<form>
				<div>
					<label for="camera">Click to take a photo</label>
					<input id="camera" name="camera" type="file" accept="image/*" capture="camera" style="opacity:0" />
				</div>
			</form>
			<button class="back-button" id="page-4-back">Touch to go back</button>
			<button class='next-button' id="page-4-forward">Touch to continue</button>
		</div>
		<div class="page" id="page-5">
			<h2>Do you have any of these symptoms?</h2>
			<table>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Itching</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Burning</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Irregular discharge</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Painful or burning urination</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Pelvic pain</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Lower back pain</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Fever</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Sore throat</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Nausea</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Genital swelling</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="symptom">Strong odor</td>
			</table>
			<button class="back-button" id="page-5-back">Touch to go back</button>
			<button class='next-button' id="page-5-forward">Touch to continue</button>
		</div>
		<div class="page" id="page-6">
			<h2>How long have you had these symptoms?</h2>
			<table>
				<tr>
					<td class="check-mark"></td>
					<td class="time-frame">Less than a day</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="time-frame">Less than a week</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="time-frame">Less than a month</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="time-frame">Less than a year</td>
				</tr>
				<tr>
					<td class="check-mark"></td>
					<td class="time-frame">More than a year</td>
				</tr>
			</table>
			<button class="back-button" id="page-6-back">Touch to go back</button>
			<button class='next-button' id="page-6-forward">Touch to continue</button>
		</div>
		<div class="page" id="page-7">
			<div>
				<h2>What is your age?</h2>
				<input id="age" type="tel">
			</div>
			<div>
				<h2>Gender?</h2>
				<div id="gender-container">
					<div class="genders">Female</div>
					<div class="genders">Male</div>
					<div class="genders">Other</div>
				</div>
			</div>
			<div>
				<input id="zip" type="tel">
					We only collect location information to identify new outbreaks for public health research.
				<p>
			</div>
			<button class="back-button" id="page-7-back">Touch to go back</button>
			<button class='finish' id="send">Submit your information</button>
		</div>
	<body>
</html>
